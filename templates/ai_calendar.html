{% extends "layout.html" %}

{% block title %}AI Calendar - KITEDESK{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Main Calendar View -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i data-feather="calendar" class="feather-icon"></i>
                        AI-Powered Calendar
                    </h5>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary btn-sm" id="prev-month">
                            <i data-feather="chevron-left" class="feather-icon-xs"></i>
                        </button>
                        <button type="button" class="btn btn-outline-primary btn-sm" id="today-btn">Today</button>
                        <button type="button" class="btn btn-outline-primary btn-sm" id="next-month">
                            <i data-feather="chevron-right" class="feather-icon-xs"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Calendar Navigation -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 id="calendar-month-year" class="mb-0"></h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <input type="radio" class="btn-check" name="view-options" id="month-view" checked>
                            <label class="btn btn-outline-secondary" for="month-view">Month</label>

                            <input type="radio" class="btn-check" name="view-options" id="week-view">
                            <label class="btn btn-outline-secondary" for="week-view">Week</label>

                            <input type="radio" class="btn-check" name="view-options" id="day-view">
                            <label class="btn btn-outline-secondary" for="day-view">Day</label>
                        </div>
                    </div>

                    <!-- Calendar Grid -->
                    <div id="calendar-container">
                        <div class="calendar-grid" id="calendar-grid">
                            <!-- Calendar will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Event Details Modal -->
                    <div class="modal fade" id="eventModal" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Event Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <div id="event-details">
                                        <!-- Event details populated by JavaScript -->
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" id="edit-event-btn">Edit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Assistant Panel -->
        <div class="col-md-4">
            <!-- Voice Command Panel -->
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i data-feather="mic" class="feather-icon-xs"></i>
                        Voice Commands
                    </h6>
                </div>
                <div class="card-body">
                    <button type="button" class="btn btn-primary w-100 mb-2" id="voice-btn">
                        <i data-feather="mic" class="feather-icon-xs me-1"></i>
                        <span id="voice-btn-text">Hold to Speak</span>
                    </button>
                    <div class="alert alert-info py-2 mb-0">
                        <small>
                            <i data-feather="info" class="feather-icon-xs me-1"></i>
                            Try: "Schedule a meeting with John tomorrow at 2pm" or "What's my schedule today?"
                        </small>
                    </div>
                </div>
            </div>

            <!-- AI Chat Interface -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i data-feather="message-circle" class="feather-icon-xs"></i>
                        AI Calendar Assistant
                    </h6>
                </div>
                <div class="card-body">
                    <!-- Chat Messages -->
                    <div id="chat-messages" class="chat-messages mb-3">
                        <div class="message ai-message">
                            <div class="message-content">
                                <strong>KITEDESK Calendar:</strong> Hi! I'm your AI calendar assistant. I can help you schedule events, find conflicts, and manage your calendar using natural language. What would you like to do?
                            </div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="input-group">
                        <input type="text" class="form-control" id="chat-input" 
                               placeholder="Ask me to schedule something...">
                        <button class="btn btn-primary" type="button" id="send-chat">
                            <i data-feather="send" class="feather-icon-xs"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i data-feather="zap" class="feather-icon-xs"></i>
                        Quick Actions
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-outline-primary btn-sm" id="schedule-meeting">
                            <i data-feather="users" class="feather-icon-xs me-1"></i>
                            Schedule Meeting
                        </button>
                        <button type="button" class="btn btn-outline-success btn-sm" id="add-reminder">
                            <i data-feather="bell" class="feather-icon-xs me-1"></i>
                            Add Reminder
                        </button>
                        <button type="button" class="btn btn-outline-info btn-sm" id="view-today">
                            <i data-feather="eye" class="feather-icon-xs me-1"></i>
                            Today's Schedule
                        </button>
                        <button type="button" class="btn btn-outline-warning btn-sm" id="find-time">
                            <i data-feather="search" class="feather-icon-xs me-1"></i>
                            Find Free Time
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-bottom: none;
    }
    
    .calendar-header-day {
        background-color: #fff;
        color: #6c757d;
        padding: 12px 8px;
        text-align: center;
        font-weight: 600;
        font-size: 0.875rem;
        border-right: 1px solid #dee2e6;
    }
    
    .calendar-header-day:last-child {
        border-right: none;
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        border: 1px solid #dee2e6;
        border-top: none;
    }
    
    .calendar-day {
        background-color: white;
        min-height: 100px;
        padding: 8px;
        position: relative;
        cursor: pointer;
        transition: background-color 0.2s;
        border-right: 1px solid #dee2e6;
        border-bottom: 1px solid #dee2e6;
        display: flex;
        flex-direction: column;
    }
    
    .calendar-day:nth-child(7n) {
        border-right: none;
    }
    
    .calendar-day:hover {
        background-color: #f8f9fa;
    }
    
    .calendar-day.other-month {
        background-color: #f8f9fa;
        color: #999;
    }
    
    .calendar-day.today .calendar-day-number {
        background-color: #ff6b35;
        color: white;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
    }
    
    .calendar-day-number {
        font-weight: 600;
        margin-bottom: 4px;
        font-size: 0.875rem;
        color: #495057;
        text-align: center;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .calendar-day.other-month .calendar-day-number {
        color: #adb5bd;
    }
    
    .calendar-event {
        background-color: #3498db;
        color: white;
        font-size: 0.75rem;
        padding: 2px 4px;
        margin: 1px 0;
        border-radius: 3px;
        cursor: pointer;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .calendar-event.ai-created {
        background-color: #9b59b6;
    }
    
    .calendar-event.meeting {
        background-color: #3498db;
    }
    
    .calendar-event.appointment {
        background-color: #2ecc71;
    }
    
    .calendar-event.deadline {
        background-color: #e74c3c;
    }
    
    .calendar-event.reminder {
        background-color: #f39c12;
    }
    
    .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background-color: #e0e0e0;
        margin-bottom: 1px;
    }
    
    .calendar-header-day {
        background-color: #f5f5f5;
        padding: 10px 8px;
        text-align: center;
        font-weight: 600;
        color: #666;
    }
    
    .chat-messages {
        max-height: 400px;
        overflow-y: auto;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 0.375rem;
    }
    
    .message {
        margin-bottom: 15px;
    }
    
    .message-content {
        padding: 8px 12px;
        border-radius: 10px;
        margin-bottom: 4px;
    }
    
    .ai-message .message-content {
        background-color: #e3f2fd;
        border: 1px solid #bbdefb;
    }
    
    .user-message .message-content {
        background-color: #e8f5e8;
        border: 1px solid #c8e6c9;
        margin-left: 20px;
    }
    
    .message-time {
        font-size: 0.75rem;
        color: #666;
        text-align: right;
    }
    
    .user-message .message-time {
        margin-right: 20px;
    }
    
    .voice-recording {
        background-color: #dc3545 !important;
        animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.7; }
        100% { opacity: 1; }
    }
    
    .feather-icon-xs {
        width: 14px;
        height: 14px;
    }
    
    /* Calendar container styling */
    #calendar-container {
        overflow: hidden;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Ensure calendar takes full width */
    .calendar-header,
    .calendar-grid {
        width: 100%;
        box-sizing: border-box;
    }
    
    /* Fix calendar day alignment */
    .calendar-day {
        min-height: 100px;
        overflow: hidden;
    }
    
    /* Responsive calendar on smaller screens */
    @media (max-width: 768px) {
        .calendar-day {
            min-height: 80px;
            padding: 4px;
        }
        
        .calendar-header-day {
            padding: 8px 4px;
            font-size: 0.75rem;
        }
        
        .calendar-day-number {
            font-size: 0.75rem;
        }
        
        .calendar-event {
            font-size: 0.65rem;
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/ai_calendar.js') }}"></script>
{% endblock %}